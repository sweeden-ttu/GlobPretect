#!/bin/sh
# Post-merge hook: fire when @macbook or @rockydesktop appears in any merged commit message.
# Runs after fetch_and_merge (git merge). See docs/GIT_HOOKS.md.

HOOK_DIR="$(cd "$(dirname "$0")" && pwd)"
REPO_ROOT="$(git rev-parse --show-toplevel 2>/dev/null)"
cd "$REPO_ROOT" || exit 0

# Commits just merged (ORIG_HEAD..HEAD)
if ! git rev-parse -q --verify ORIG_HEAD >/dev/null 2>&1; then
    exit 0
fi

MERGED_MSGS=$(git log ORIG_HEAD..HEAD --format=%B 2>/dev/null)
echo "$MERGED_MSGS" | grep -qE '@macbook|@rockydesktop' || exit 0

# Trigger handler (optional; create on-macbook-comment in same dir to customize)
if [ -x "$HOOK_DIR/on-macbook-comment" ]; then
    exec "$HOOK_DIR/on-macbook-comment" "$REPO_ROOT" "$MERGED_MSGS"
fi

# Default: log and exit 0 so merge is not aborted
echo "[post-merge] @macbook or @rockydesktop found in merged commits; run .githooks/on-macbook-comment for custom action."
exit 0
